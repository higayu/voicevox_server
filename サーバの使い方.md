

```bash
ps aux | grep uvicorn

fuser -k 9002/tcp

sudo lsof -i :9002

sudo kill -9 290996

sudo systemctl restart voicevox.service

sudo systemctl status voicevox.service -n 20

```

```bash
source venv/bin/activate
```


```bash
sudo systemctl restart voicevox.service
sudo systemctl restart apache2
```

# 設定ファイルの編集
```bash
sudo nano /etc/apache2/sites-enabled/voicevox.conf
```

```
<VirtualHost *:8082>
    ServerName voicevox.local

    ProxyPreserveHost On
    ProxyRequests Off
    ProxyTimeout 600
    Timeout 600

    # ここ大事 → /voicevox/ を 9002 に転送
    ProxyPass        /voicevox/ http://127.0.0.1:9002/
    ProxyPassReverse /voicevox/ http://127.0.0.1:9002/

    # ログ
    ErrorLog ${APACHE_LOG_DIR}/voicevox_error.log
    CustomLog ${APACHE_LOG_DIR}/voicevox_access.log combined
</VirtualHost>
```

# 呼び出し方
```bash
curl "http://192.168.1.221:8082/voicevox/speak?text=おはようございます" -o zunda.wav
```

```
<VirtualHost *:8082>
    ServerName voicevox.local

    ProxyPreserveHost On
    ProxyRequests Off
    ProxyTimeout 600
    Timeout 600

    # スラッシュあり
    ProxyPass        /voicevox/ http://127.0.0.1:9002/
    ProxyPassReverse /voicevox/ http://127.0.0.1:9002/

    # スラッシュなし
    ProxyPass        /voicevox http://127.0.0.1:9002/
    ProxyPassReverse /voicevox http://127.0.0.1:9002/

    ErrorLog ${APACHE_LOG_DIR}/voicevox_error.log
    CustomLog ${APACHE_LOG_DIR}/voicevox_access.log combined
</VirtualHost>
```

```bash
sudo nano /etc/systemd/system/voicevox.service
```

```
[Unit] 
Description=VOICEVOX FastAPI Server
After=network.target 

[Service]
WorkingDirectory=/var/www/voicevox_server 
ExecStart=/var/www/voicevox_server/venv/bin/python -m uvicorn 
app:app --host 127.0.0.1 > 
Restart=always 
User=gym-sever 
Group=gym-sever 
Environment="PATH=/var/www/voicevox_server/venv/bin" 

[Install] WantedBy=multi-user.target
```

```
[Unit]
Description=VOICEVOX FastAPI Server
After=network.target

[Service]
WorkingDirectory=/var/www/voicevox_server
ExecStart=/var/www/voicevox_server/venv/bin/python -m uvicorn app:app --host 0.0.0.0 --port 9002
Restart=always
User=gym-sever
Group=gym-sever
Environment="PATH=/var/www/voicevox_server/venv/bin"

[Install]
WantedBy=multi-user.target
```

# systemd をリロード
```bash
sudo systemctl daemon-reload
sudo systemctl restart voicevox.service
sudo systemctl status voicevox.service -n 30
```